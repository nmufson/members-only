const db = require('../db/queries');
const formatDateTime = require('../utils/formatDateTime');

function setLocalsUser(req, res, next) {
  res.locals.user = req.user;

  next();
}

async function setLocalsMessages(req, res, next) {
  const messages = await db.getAllMessages();
  messages.forEach((msg) => {
    const { date, time } = formatDateTime(msg.timestamp);
    msg.formattedDate = date;
    msg.formattedTime = time;
  });
  res.locals.messages = messages;

  next();
}

async function setLocalsFormErrors(req, res, next) {
  res.locals.formErrors = req.session.formErrors || [];
  req.session.formErrors = []; // Reset formErrors after passing them to locals
  next();
}

module.exports = { setLocalsUser, setLocalsMessages, setLocalsFormErrors };
